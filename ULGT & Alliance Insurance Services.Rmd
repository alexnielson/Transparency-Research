---
title: "Utah Local Governments Trust & Alliant Insurance Services"
author: "Michael Jensen"
output: html_notebook
---
# Program Description

**Purpose**

A concerned citizen wants to know why the information Utah Local Governments Trust uploaded to Transparent Utah doesn't contain expenses paid to Alliant Insurance Services.

**Input(s)**

```{r}
dsn_aws <- "transpAWS"
```

**Output(s)**



# Libraries and Data Sources

```{r}
library(odbc)
library(tidyverse)

odbc_aws <- dbConnect(odbc::odbc(), dsn_aws)
rm(dsn_aws)
```

# Function Definitions

## Argument Definitions

```{r, eval=FALSE}

```


# Execution

The Transparent Utah ID for Utah Local Governments Trust is 935.

```{r}
trxns <- 
  dbGetQuery(
    odbc_aws,
    paste("
          SELECT 
            posting_date, amount, fiscal_year, description, t.type, 
            tg1.name AS org1, tg2.name AS org2, tg3.name AS org3,
            tg4.name AS cat1, tg4.name AS cat2, tg6.name AS cat3,
            tg7.name AS fund1, tg8.name AS fund2,
            v.name AS vendor_name, account_number
          FROM transaction AS t
          LEFT JOIN transaction_group AS tg1
            ON t.org1 = tg1.id
          LEFT JOIN transaction_group AS tg2
            ON t.org2 = tg2.id
          LEFT JOIN transaction_group AS tg3
            ON t.org3 = tg3.id
          LEFT JOIN transaction_group AS tg4
            ON t.cat1 = tg4.id
          LEFT JOIN transaction_group AS tg5
            ON t.cat2 = tg5.id
          LEFT JOIN transaction_group AS tg6
            ON t.cat3 = tg6.id
          LEFT JOIN transaction_group AS tg7
            ON t.fund1 = tg7.id
          LEFT JOIN transaction_group AS tg8
            ON t.fund2 = tg8.id
          LEFT JOIN vendor AS v
            ON t.vendor_id = v.id
          WHERE batch_id IN (
            SELECT id
            FROM batch
            WHERE entity_id = ", 935, "
            AND status IN ('PROCESSED', 'PROCESSING', 'DONTDELETE'))"))

vendors <- 
  trxns %>% 
  distinct(vendor_name)
```

# DBMS Disconnection

```{r}
dbDisconnect(odbc_aws)
```