---
title: "Browse an Entity's StateDW Data"
author: "Michael Jensen"
output: html_notebook
---
# Inputs, Packages, & Data Connections

```{r}
library(odbc)

odbc_dw  <- dbConnect(odbc::odbc(), "StateDW", password = "DW1234")
```

Using the Adaptive Server Enterprise ODBC to select a table from State Data Warehouse (StateDW) requires calling the table as <database>.<owner>.<object_name>.<column_name>. Use "sp_help" to identify the owner:

```{r}
sp_help <- 
  dbGetQuery(
    odbc_dw,
    "sp_help")
```

# Table Query Templates

## Account_Type Table

* Expenditures is the account type used to describe money out. Expenses is the account type used to describe money out and things like depreciation. Only certain funds use the expense type.

```{sql, connection=odbc_dw, output.var=account_type_table}
SELECT *
FROM Account_Type
```

## Accounting_Journal Table

Use a WHERE statement in the query below, as the table is large enough that R may not be able to import all the information or will take a long time to do so.

Transaction ID:

* JVA: Like an IET, but used by the Division of Finance because it allows for more options.
* JVYE: A year-end adjustment.
* GAX: A written check, used when making a payment to a non-contracted vendor.
* AD: Something generated by FINET (Lynn Webb from Division of Finance said that he excludes these transactions when he looks through the dataâ€”they aren't helpful).

```{sql, connection=odbc_dw, output.var=accounting_journal_table}
SELECT 
  Account_Type,
  Amount,
  Department,
  Fiscal_Year_Period,
  Line_Description,
  Vendor_Customer,
  Vendor_Customer_Name,
  Tran_ID
FROM StateDW.dbo.Accounting_Journal
WHERE  LIKE 
```

## Department Table

```{sql, connection=odbc_dw, output.var=department_table}
SELECT *
FROM StateDW.dbo.Department
```

* 090: State Auditor

## Division Table

```{sql, connection=odbc_dw, output.var=division_table}
SELECT Fiscal_Year, Department, Division, Division_Name
FROM StateDW.dbo.Division
```

## Employee Data Table

```{sql, connection=odbc_dw, output.var=employee_data_table}
SELECT *
FROM StateDW.dbo.Employee_Data
```

## Fund Table

```{sql, connection=odbc_dw, output.var=fund_table}
SELECT *
FROM StateDW.dbo.Fund
```

## Vendor_Customer Table

```{sql, connection=odbc_dw, output.var=vendor_customer_table}
SELECT 
  Vendor_Customer,
  Legal_Name, 
  Alias_Name,
  Parent_Account_Code, 
  Effective_Begin_Date,
  Classification
FROM StateDW.dbo.Vendor_Customer
```

# Close

```{r}
dbDisconnect(odbc_dw)
rm(list = ls())
```

# Workspace

```{r}
osa_id <- "090"
```