---
title: "Election Campaign Fund Payees"
date: '`r format(Sys.Date(), "%B %e, %Y ")`'
output: html_notebook
---
***
### Introduction

The purpose of this report is to determine whether the payees for Election Campaign Fund contributions are reported to Transparency.

**Background**

Utah's Individual Income Tax Contribution Act created the opportunity for a taxpayer to designate on his or her individual income tax return a \$2 contribution to a registered political party (*U.C. 59-10-1311*). The contribution is "free" from the taxpayer's perspective, as choosing to make a contribution does not affect the taxpayer's tax refund. Instead, the \$2 contribution is transferred from the General Fund to the Election Campaign Fund. The Office of the State Treasurer is responsible for distributing the contributions in the Election Campaign Fund to the appropriate political party. Contributions are distributed almost monthly.

From July 2008 to July 2018, the State of Utah reported contributions distributed to the political parties as a lump sum, which meant that Transparency could not be used to determine the amounts distributed to each political party. As the State Auditor is responsible for monitoring entities that receive public monies (above a certain threshold, in the case of political parties), he requested that the Office of the State Treasurer report the actual transaction to Transparency rather than a summary transaction. Doing so would allow him to use the Transparency data to determine which political parties he is responsible to monitor, if any.

***
### Analysis

```{r setup}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE}
library(knitr)
library(odbc)
library(tidyverse)

odbc_aws <- dbConnect(odbc::odbc(), "transpAWS")
```

```{sql, connection=odbc_aws, output.var="ecf_ids"}
SELECT *
FROM transaction_group
WHERE name = "(TRS) Election Campaign Fund"
```

```{sql, connection=odbc_aws, output.var="ecf_parent_ids"}
SELECT id, name, parent_id, type
FROM transaction_group
WHERE id IN (1000843, 1446563)
```

```{sql, connection=odbc_aws, output.var = "ecf_contributions"}
SELECT vendor.name AS vendor_name,
       transaction.vendor_id, 
       transaction.description, 
       transaction.posting_date, 
       transaction.amount, 
       transaction.fiscal_year,
       transaction.entity_trans_id
FROM transaction
JOIN vendor
ON transaction.vendor_id = vendor.id
WHERE 
((fund1 = 1000843 AND fund2 = 1000873) OR (org2 = 1446563 AND org3 = 1446567))
AND transaction.type = 1
```

**Reported Vendor Names**

```{r}
ecf_contributions %>% 
  distinct(vendor_name)
```

```{r, eval=FALSE}
# After reviewing the distinct vendor names, insert "are" or "are not" below:
are_or_are_not <- "are not"
```

As shown in the table above, payee names `r are_or_are_not` reported to Transparency.

**Sample of Data**

```{r}
ecf_contributions %>% 
  arrange(desc(posting_date)) %>% 
  select(posting_date, vendor_name, amount) %>% 
  head() %>% 
  kable(row.names = FALSE, 
        col.names = c("Posting Date", "Payee Name", "Amount ($)"),
        align = "l")
```

```{r, eval=FALSE}
dbDisconnect(odbc_aws)
rm(list = ls())
```